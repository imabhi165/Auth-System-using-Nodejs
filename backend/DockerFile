# Use an official Node.js runtime as a base image
FROM node:18-alpine AS base

# Set working directory
WORKDIR /usr/src/app

# Set environment
ENV NODE_ENV=production

# Install app dependencies
COPY package*.json ./
RUN npm ci --only=production

# Copy application source
COPY . .

# Create a non-root user and switch to it for security
RUN addgroup -S app && adduser -S app -G app
USER app

# Expose the port the app runs on
EXPOSE 5000

# Default command
CMD ["node", "src/server.js"]

# ------------------
# Build & run examples:
# docker build -t auth-backend:latest .
# docker run -e MONGO_URI="your-mongo-uri" -p 5000:5000 auth-backend:latest
# ------------------
# Notes:
# - Set any other env vars (e.g., JWT_SECRET) at runtime with -e or via a Docker compose file.
# - Consider adding a .dockerignore file to exclude node_modules, logs, and local config files from the image.
